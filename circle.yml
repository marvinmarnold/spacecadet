dependencies:
  override:
    # Install Meteor
    - curl https://install.meteor.com | sh

checkout:
  # Write ENV variables to server
  post:
    - echo $METEOR_SETTINGS > "server/settings.json"

test:
  override:
    # Run tests in Velocity CI Mode
    - meteor --test --settings=server/settings.json:
        environment:
          VELOCITY_CI: true
          CUCUMBER_SCREENSHOTS_DIR: "$CIRCLE_ARTIFACTS/screenshots"
          CUCUMBER_JSON_OUTPUT: "$CIRCLE_TEST_REPORTS/results.cucumber"
    - cp .meteor/local/log/*.log $CIRCLE_ARTIFACTS